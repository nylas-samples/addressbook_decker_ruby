# frozen_string_literal: true

# Import your dependencies
require 'nylas'
require 'dotenv/load'
require 'mini_magick'
require 'open-uri'

# Initialize your Nylas API client
nylas = Nylas::Client.new(
  api_key: ENV['V3_TOKEN']
)

deck_source = '{deck}' + "\n" + 'version:1' + "\n" + 'card:0' + "\n" + 'size:[512,342]' + "\n" + 'name:"contacts.deck"' \
              "\n\n" + '{fonts}' + "\n" + 'deckbuilder:"%%FNT0GCABAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADgAADgAAAAAADgAADgAADgAADgAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAA2AAA2AAA2AAA2AAA2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAABmAABmAABmAABmAADMAADMAAP\/AAP\/AAP\/AADMAADMAADMAAP\/AAP\/AAP\/AAGYAAGYAAGYAAGYAAMwAAMwAAMwAAMwAAAAAAAAAAAAAAAAAAAAAAAAAAAsEAAAEAAAEAAA\/gAB\/wAD\/4AD\/4AD14AD14AD14AD94AD8AAB+AAA\/AAAfgAAPwAAHwAD34AD14AD14AD14AD14AD14AD\/4AB\/wAA\/gAAEAAAEAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAeDAA\/HAA7GAA7GAA7MAA7MAA7MAA7YAA\/YAAeYAAAwAAAwAABgAABngADPwADOwADOwAGOwAGOwAGOwAMOwAMPwAMHgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAB8AAD+AAH+AAHuAAHuAAHuAAH+AAD+AAD8AAB44AD44AH44AH94AP94APfwAOPwAOPgAPHwAPPwAP\/4AH\/4AD84AB44AAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAADgAADgAADgAADgAADgAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGDAAAHAAAOAAAOAAAcAAAcAAAcAAA8AAA8AAA8AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA8AAA8AAAcAAAcAAAcAAAOAAAOAAAOAAAHAAADAAAAAAAAAAAAAAABsAAAOAAAHAAAHAAADgAADgAADgAADwAADwAADwAABwAABwAABwAABwAABwAABwAABwAABwAABwAADwAADwAADgAADgAADgAAHAAAHAAAHAAAOAAAMAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAC0AAB4AAB4AAB4AAC0AAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAHAAAHAAA\/4AA\/4AA\/4AAHAAAHAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAOAAAGAAAGAAAEAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4AAD4AAD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAA8AAA8AAAAAAAAAAAAAAAAAAAAAAAAAAABgwAAAwAAAwAABwAABwAABgAABgAABgAABgAADgAADgAADgAADAAADAAADAAAHAAAHAAAHAAAGAAAGAAAGAAAGAAAOAAAOAAAMAAAMAAAMAAAMAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAA\/AAB\/gAD\/wAD\/wADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwAD\/wAD\/wAB\/gAA\/AAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAAAAAAAAHAAAPAAA\/AAA\/AAA\/AAA\/AAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAD8AAH+AAP\/AAPPAAPPAAPPAAPPAAAPAAAfAAAeAAA+AAB8AAD4AADwAAHgAAHvAAPPAAPPAAPPAAP\/AAP\/AAP\/AAP\/AAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAA\/AAB\/gAD\/wADzwADzwADzwADzwAADwAADwAAPgAAPwAAPwAADwAADwADzwADzwADzwADzwADzwAD\/wAD\/wAB\/gAA\/AAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAB4AAB4AAD4AAD4AAD4AAH4AAH4AAH4AAP4AAP4AAO4AAe4AAc4AAc4AA\/+AA\/+AA\/+AA\/+AAB4AAB4AAB4AAB4AAB4AAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAP\/AAP\/AAP\/AAP\/AAPAAAPAAAPcAAP+AAP\/AAP\/AAPPAAOPAAAPAAAPAAPPAAPPAAPPAAPPAAPPAAP\/AAP\/AAH+AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAA\/AAB\/gAD\/wAD7wADzwADzwADzwADwAAD3gAD\/wAD\/wADzwADzwADzwADzwADzwADzwADzwADzwAD\/wAD\/wAB\/gAA\/AAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAA\/8AA\/8AA\/8AA88AA88AA84AA84AAB4AAB4AABwAABwAADwAADwAADwAADwAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAD8AAH+AAP\/AAPPAAPPAAPPAAPPAAPPAAPPAAH+AAH+AAH+AAP\/AAPPAAPPAAPPAAPPAAPPAAPPAAPPAAP\/AAH+AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAB\/AAD\/gAD\/wADzwADzwADzwADzwADzwADzwADzwAD\/wAD\/wAD\/wAB7wAADwAADwADzwADzwADzwADzwAD\/wAB\/gAA\/AAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAA4AAA4AAA4AAAAAAAAAAAAAAAAAAAAAAA4AAA4AAA4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAOAAAAAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAOAAAGAAAGAAAEAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAHgAAfgAB+AAD4AAB+AAAfgAAHgAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\/4AA\/4AA\/4AAAAAA\/4AA\/4AA\/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAPAAAPwAAD8AAA+AAD8AAPwAAPAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAB\/AAD\/gAD\/gADngADngADngADngADngAAHgAAPAAAPAAAfAAAeAAAeAAAeAAAeAAAeAAAeAAAAAAAeAAAeAAAeAAAeAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAA\/AAD\/wAH\/4APA8AOAcAcAOAc7uAd\/mA5\/mA5zmA5zmA5zmA5zmA5zmA5zmA5zmA5zmA5zuA53sA5\/8Ad94Ac4wAcAAAOAYAPh4AH\/wAB\/AAAAAAAAAAAAAAAAAACgAAAAAAAB4AAB4AAB4AAB8AAD8AAD8AAD8AAD8AADcAADcAAHeAAHeAAHOAAHOAAHOAAHOAAP\/AAP\/AAP\/AAP\/AAPPAAPPAAPPAAPPAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAD\/AAD\/gAD\/wAD\/wADzwADzwADzwADzwADzwADzgAD\/AAD\/gAD\/wAD\/wADzwADzwADzwADzwADzwADzwAD\/wAD\/wAD\/gAD\/AAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAPwAAf4AA\/8AA\/8AA88AA88AA88AA88AA88AA8AAA8AAA8AAA8AAA88AA88AA88AA88AA88AA88AA88AA\/8AA\/8AAf4AAPwAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAP8AAP+AAP\/AAP\/AAPfAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAP\/AAP\/AAP+AAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAD\/gAD\/gAD\/gAD\/gADwAADwAADwAADwAADwAADwAAD+AAD+AAD+AAD+AADwAADwAADwAADwAADwAADwAAD\/gAD\/gAD\/gAD\/gAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAA\/4AA\/4AA\/4AA\/4AA8AAA8AAA8AAA8AAA8AAA8AAA\/wAA\/wAA\/wAA\/wAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAD8AAH+AAP\/AAP\/AAPPAAPPAAPPAAPPAAPAAAPAAAPfAAPfAAPfAAPfAAPPAAPPAAPPAAPPAAPPAAPPAAP\/AAP\/AAH7AADzAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAADzwADzwADzwADzwADzwADzwADzwADzwADzwAD\/wAD\/wAD\/wAD\/wAD\/wADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAP\/AAP\/AAH+AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAADx4ADx4ADzwADzwADzgAD3gAD3gAD3AAD\/AAD\/AAD+AAD+AAD+AAD\/AAD\/AAD\/AAD3gAD3gAD3gADzwADzwADzwADx4ADx4AAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA\/4AA\/4AA\/4AA\/4AAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAPh8APh8APh8APh8APx8APx8APz8APz8AP78AP78AP78AP78AP\/8AP\/8APe8APe8APe8APe8APe8APe8APM8APM8APM8APM8AAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAADx4ADx4ADx4AD54AD54AD54AD94AD94AD94AD\/4AD\/4AD\/4AD\/4AD\/4AD34AD34AD34ADz4ADz4ADz4ADx4ADx4ADx4ADx4AAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAPwAAf4AA\/8AA\/8AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA\/8AA\/8AAf4AAPwAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAP8AAP+AAP\/AAP\/AAPPAAPPAAPPAAPPAAPPAAPPAAP\/AAP\/AAP+AAP8AAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAA\/AAB\/gAD\/wAD\/wADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwAD\/wAD\/wAB\/wAA\/gAAOAAAPAAAPAAAPgAAAAAAAAAAKAAAAAAAA\/wAA\/4AA\/8AA\/8AA88AA88AA88AA88AA88AA94AA\/wAA\/4AA\/8AA\/8AA88AA88AA88AA88AA88AA88AA88AA88AA88AA8+AAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAD8AAH+AAP\/AAP\/AAPPAAPPAAPPAAPPAAPgAAPwAAH4AAD8AAB+AAA+AAAfAAPPAAPPAAPPAAPPAAPPAAP\/AAP\/AAH+AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAD\/wAD\/wAD\/wAD\/wAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA\/8AA\/8AAf4AAPwAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAPngAPngAPngAPngAPngAHngAHngAHnAAHvAAHvAAHvAAHvAAHvAAD\/AAD+AAD+AAD+AAB8AAB8AAB8AAB8AAB4AAB4AAB4AAAAAAAAAAAAAAAAAAAAAAAAAABEAAAAAAADx54Dx54Dx54Dx54Dx54Bx5wBx5wBx5wB79wB79wB79wB79wB79wA\/fgA\/fgA\/fgA\/fgA\/fgA\/fgA\/fgAePAAePAAePAAePAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAA88AA88AA88AA84AA94AAd4AAfwAAfwAAfwAAPgAAPgAAPgAAPgAAfwAAfwAAfwAAfwAAdwAA94AA94AA94AA44AA44AA44AAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAOPAAOPAAOPAAPOAAPOAAHeAAHeAAHcAAH8AAD8AAD8AAD4AAD4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAD\/gAD\/gAD\/gAD\/gAAHgAAHgAAPAAAPAAAPAAAeAAAeAAAeAAA8AAA8AAA8AAB4AAB4AAB4AADwAADwAAD\/gAD\/gAD\/gAD\/gAAAAAAAAAAAAAAAAAAAAAAAAAAF+AAA+AAA+AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA+AAA+AAA+AAAAAAAAAAAAAAAAAAABsAAAMAAAMAAAOAAAOAAAGAAAGAAAGAAAGAAAHAAAHAAAHAAADAAADAAADAAADgAADgAADgAABgAABgAABgAABgAABwAABwAAAwAAAwAAAwAAAwAAAAAAAAAAAAAAAAAAAX4AAD4AAD4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAD4AAD4AAD4AAAAAAAAAAAAAAAAAAAGAAAAAAAAMAAAeAAAeAAAeAAAeAAA\/AAAzAAAzAAAzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP\/AAP\/AAP\/AAAAAAAAAAAUAAAAAAADgAADwAABwAAB4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfgAA\/wAA\/wAA5wAA5wAABwAAHwAAfwAA\/wAA9wAA5wAA5wAA5wAA54AA\/4AA\/4AAd4AAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAO4AAP8AAP8AAP8AAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAP8AAP8AAP8AAN4AAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8AAD+AAD\/AAD\/AADnAADnAADnAADgAADgAADgAADnAADnAADnAADnAAD\/AAD\/AAB+AAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAABwAABwAABwAABwAABwAABwAAdwAA\/wAA\/wAA\/wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA\/wAA\/wAA\/wAAewAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAH4AAP8AAOcAAOcAAOcAAP8AAP8AAP8AAOAAAOAAAOcAAOcAAOcAAP8AAP4AAHwAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAeAAA+AAA+AAA4AAA4AAA4AAD+AAD+AAD+AAD+AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAewAA\/wAA\/wAA\/wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA7wAA\/wAA\/wAAdwAABwAA5wAA5wAA\/wAA\/gAAfAAACAAAAAAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAO4AAP8AAP8AAP8AAPcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAADgAADgAADgAAAAAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAA+AAA+AAA8AAACQAAAAAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAOOAAOeAAOcAAO8AAO4AAP4AAPwAAPwAAPwAAP4AAP4AAO4AAO8AAOcAAOeAAOOAAOOAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADwAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA73AA\/\/gA\/\/gA\/\/gA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAO4AAP8AAP8AAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+AAD\/AAD\/AADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAAD\/AAD\/AAB+AAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7gAA\/wAA\/wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA\/wAA\/wAA7gAA4AAA4AAA4AAA4AAA4AAA4AAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHcAAP8AAP8AAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAP8AAP8AAHcAAAcAAAcAAAcAAAcAAAcAAAcAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADuAAD\/AAD\/AADnAADnAADnAADnAADnAADgAADgAADgAADgAADgAADgAADgAADgAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfgAA\/wAA\/wAA5wAA5wAA8AAA+AAAfAAAPgAAHwAADwAA5wAA5wAA5wAA\/wAA\/wAAfgAAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAADgAADgAADgAADgAADgAAP4AAP4AAP4AAP4AADgAADgAADgAADgAADgAADgAADgAADgAADgAAD4AAD4AAD4AAB4AAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAAD\/AAD\/AAD\/AAB7AAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA84AA84AA84AA84AA84AAd4AAd4AAdwAAdwAAfwAAPwAAPwAAPgAAPgAAHgAAHgAAHAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPPOAPPOAPPOAPPOAPPOAHfeAHfcAHfcAH\/8AH\/8AD78AD78AD74AD74AB54AB54AB54AAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADjgADjgAD3gAB3AAB\/AAB\/AAA+AAA+AAA+AAA+AAA+AAB\/AAB\/AAB3AAD3gADjgADjgAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA44AA44AA44AA44AA9wAAdwAAdwAAfwAAfwAAfwAAPgAAPgAAPgAAPgAAPgAAPgAAHAAAHAAAHAAAPAAA\/AAA+AAA8AAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAP8AAP8AAAcAAA4AAA4AABwAABwAADgAADgAAHAAAHAAAPAAAOAAAP8AAP8AAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAY8AAB8AAB8AABwAABwAABwAABwAABwAAB4AAA4AAA4AAA4AAA4AAD4AADwAAD4AAA4AAA4AAA4AAA4AAB4AAB4AABwAABwAABwAABwAAB8AAB8AAA8AAAAAAAAAAAAAAAD4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAAAAAAAAAAAAAABvAAAPgAAPgAADgAADgAADgAADgAADgAAHgAAHAAAHAAAHAAAHAAAHwAADwAAHwAAHAAAHAAAHAAAHAAAHgAAHgAADgAADgAADgAADgAAPgAAPgAAPAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABzAAD7AAD\/AAD\/AADfAADOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA2wAA2wAA2wAA2wAAAAAAAAAAAAAAAAAAAAAAAAAA"' \
              "\n\n" + '{card:home}' + "\n" + '{widgets}' + "\n" \
              'Title:{"type":"field","size":[149,38],"pos":[177,90],"font":"deckbuilder","style":"plain","align":"center","value":"Contacts"}' \
              "\n" + 'enter:{"type":"button","size":[60,20],"pos":[222,213],"script":"home.0","text":"Enter"}' + "\n" \
              'field1:{"type":"field","size":[149,49],"pos":[177,140],"font":"menu","style":"plain","align":"center","value":"An address book\ncreated using Decker and Nylas"}' \
              "\n\n" + '{script:home.0}' + "\n" + 'on click do' + "\n" + '  go["Next" "SlideDown"]' + "\n" + 'end' + "\n" + '{end}' + "\n\n"

# Fetch contacts
contacts, = nylas.contacts.list(identifier: ENV['GRANT_ID'])
# Needed to call scripts
first_card = "#{contacts[0][:given_name]}#{contacts[0][:surname].gsub(/\s.*/, '')}.0"
first_card_script = "#{contacts[0][:given_name]}#{contacts[0][:surname].gsub(/\s.*/, '')}.1"
counter = 0
# Loop through all contacts
contacts.each do |contact|
  counter += 1
  # Get the profile picture
  contact[:picture_url]
  file_name = 'profile.png'
  # Save the profile picture

  URI.parse(contact[:picture_url]).open do |image|
    File.open(file_name, 'wb') do |file|
      file.write(image.read)
    end
  end

  # Use MiniMagick to resize and reformat the image
  image = MiniMagick::Image.open('profile.png')
  image.resize '100x100'
  image.format 'gif'
  image.write 'profile.gif'

  # Call the Lil script
  cmd = `lilt encode.lil`

  # Make sure nothing is empty
  contact[:nickname] = '' if contact[:nickname].nil?

  contact[:birthday] = '' if contact[:birthday].nil?

  contact[:emails][0][:email] = '' if contact[:emails][0][:email].nil?

  # Generate the information for the .deck file
  deck_source += '{card:' + contact[:given_name] + contact[:surname].gsub(/\s.*/,
                                                                          '') + '}' + "\n" + '{widgets}' + "\n" \
                 'profile:{"type":"canvas","size":[100,100],"pos":[30,90],"show":"transparent","border":0,"image":"' + cmd + '","scale":1}' + "\n" \
                 'field1:{"type":"field","size":[78,20],"pos":[184,76],"font":"menu","style":"plain","value":"Given name:"}' + "\n" \
                 'givenname:{"type":"field","size":[173,20],"pos":[275,76],"font":"mono","style":"plain","align":"center","value":"' + contact[:given_name] + '"}' + "\n" \
                 'field2:{"type":"field","size":[78,20],"pos":[184,104],"font":"menu","style":"plain","value":"Nickname:"}' + "\n" \
                 'nickname:{"type":"field","size":[174,20],"pos":[274,103],"font":"mono","style":"plain","align":"center","value":"' + contact[:nickname] + '"}' + "\n" \
                 'field3:{"type":"field","size":[78,20],"pos":[184,131],"font":"menu","style":"plain","value":"Surname:"}' + "\n" \
                 'surname:{"type":"field","size":[174,20],"pos":[274,130],"font":"mono","style":"plain","align":"center","value":"' + contact[:surname] + '"}' + "\n" \
                 'field4:{"type":"field","size":[78,20],"pos":[184,158],"font":"menu","style":"plain","value":"Birthday:"}' + "\n" \
                 'birthday:{"type":"field","size":[175,20],"pos":[274,157],"font":"mono","style":"plain","align":"center","value":"' + contact[:birthday] + '"}' + "\n" \
                 'field5:{"type":"field","size":[78,20],"pos":[184,185],"font":"menu","style":"plain","value":"Email:"}' + "\n" \
                 'email:{"type":"field","size":[176,20],"pos":[274,184],"font":"mono","style":"plain","align":"center","value":"' + contact[:emails][0][:email] + '"}' + "\n" \
                 'Next:{"type":"button","size":[60,20],"pos":[258,305],"script":"home.0","text":"Next"}' + "\n" \
                 'Previous:{"type":"button","size":[60,20],"pos":[182,305],"script":"' + first_card_script + '","text":"Previous"}' + "\n\n" \
                 '{script:' + first_card_script + '}' + "\n" + 'on click do' + "\n" + '  go["Prev" "SlideDown"]' + "\n" + 'end' + "\n" + '{end}' + "\n\n"
  deck_source += "{script:#{first_card}}\non view do\n  go[0]\nend\n{end}\n\n" if counter == 1
end

# Write the source code for the .deck file
File.open('addressbook.deck', 'wb') { |f| f.puts deck_source.to_s }
